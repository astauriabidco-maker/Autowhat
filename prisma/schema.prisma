generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- MODÈLES MULTI-TENANT ---

model Tenant {
  id        String     @id @default(uuid())
  name      String
  createdAt DateTime   @default(now())
  employees Employee[]
  
  // Géolocalisation par défaut du site
  defaultLatitude  Float?
  defaultLongitude Float?
}

model Employee {
  id          String   @id @default(uuid())
  phoneNumber String   // Format E.164 (ex: +33612345678)
  name        String?
  role        String   @default("EMPLOYEE") // EMPLOYEE, MANAGER
  password    String?  // Hashé, uniquement pour les MANAGER
  
  // Relation Tenant (CRITIQUE)
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  
  attendances Attendance[]
  leaves      LeaveRequest[]

  // Un numéro est unique pour un tenant donné
  @@unique([phoneNumber, tenantId])
}

model Attendance {
  id         String    @id @default(uuid())
  checkIn    DateTime
  checkOut   DateTime?
  status     String    @default("PRESENT")
  photoUrl   String?   // URL de la photo de pointage
  
  // Géolocalisation au pointage
  latitude       Float?
  longitude      Float?
  distanceFromSite Int?   // Distance en mètres
  
  employeeId String
  employee   Employee  @relation(fields: [employeeId], references: [id])
  
  // Dénormalisation pour sécurité (Row Level Security logicielle)
  tenantId   String
  
  @@index([tenantId])
}

model LeaveRequest {
  id         String   @id @default(uuid())
  startDate  DateTime
  endDate  DateTime
  status     String   @default("PENDING")
  
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])
  
  tenantId   String
}

// --- SUPER ADMIN (Accès global) ---

model SuperAdmin {
  id          String   @id @default(uuid())
  email       String   @unique
  password    String   // Hashé avec bcrypt
  name        String
  createdAt   DateTime @default(now())
}
